import streamlit as st
import pandas as pd
from sklearn.linear_model import LinearRegression
from scipy.stats import norm
import matplotlib.pyplot as plt

st.set_page_config(page_title="ì¡¸í”¼ë€ ë³µìš©ëŸ‰ ì˜ˆì¸¡ê¸°")
st.title("ğŸ’Š ì¡¸í”¼ë€ ë³µìš©ëŸ‰ ë° ìˆ˜ë©´ ì§€ì† ì˜ˆì¸¡ê¸°")

# ì‚¬ìš©ì ì…ë ¥
st.sidebar.header("ğŸ§‘ ì‚¬ìš©ì ì •ë³´ ì…ë ¥")
ë‚˜ì´ = st.sidebar.number_input("ë‚˜ì´", min_value=10, max_value=100, value=25)
ì²´ì¤‘ = st.sidebar.number_input("ì²´ì¤‘ (kg)", min_value=30, max_value=150, value=60)
ìˆ˜ë©´ì‹œê° = st.sidebar.number_input("ìˆ˜ë©´ ì‹œì‘ ì‹œê° (ì˜ˆ: 22.5)", min_value=0.0, max_value=24.0, value=22.0)

# ë°ì´í„°ì…‹
data = {
    "ë‚˜ì´": [25, 35, 60, 45, 70, 30, 20, 50, 65, 40, 18, 55, 33, 42, 67, 38, 26, 48, 60, 31],
    "ì²´ì¤‘": [60, 70, 50, 65, 55, 68, 72, 59, 53, 61, 49, 54, 63, 58, 52, 66, 62, 60, 51, 67],
    "ìˆ˜ë©´ì‹œì‘_ì‹œê°": [23, 22, 21, 22.5, 20.5, 23.5, 24, 22, 21.5, 23, 22.5, 21, 23, 23.5, 20, 22, 22, 21, 21.5, 23],
    "ì¶”ì²œ_ë³µìš©ëŸ‰": [5, 5, 2.5, 5, 2.5, 5, 5, 5, 2.5, 5, 5, 2.5, 5, 5, 2.5, 5, 5, 5, 2.5, 5],
    "ì¶”ì²œ_ë³µìš©ì‹œê°": [22.5, 21.5, 20, 21.5, 19.5, 22, 22.5, 21.5, 20, 22, 21.5, 20.5, 22, 22.5, 19.5, 21, 21.5, 20.5, 20, 22]
}
df = pd.DataFrame(data)

# ëª¨ë¸ í•™ìŠµ
X = df[["ë‚˜ì´", "ì²´ì¤‘", "ìˆ˜ë©´ì‹œì‘_ì‹œê°"]]
y = df[["ì¶”ì²œ_ë³µìš©ëŸ‰", "ì¶”ì²œ_ë³µìš©ì‹œê°"]]
model = LinearRegression()
model.fit(X, y)

# ì˜ˆì¸¡
ì…ë ¥ê°’ = pd.DataFrame([[ë‚˜ì´, ì²´ì¤‘, ìˆ˜ë©´ì‹œê°]], columns=["ë‚˜ì´", "ì²´ì¤‘", "ìˆ˜ë©´ì‹œì‘_ì‹œê°"])
ì˜ˆì¸¡ê²°ê³¼ = model.predict(ì…ë ¥ê°’)
ì˜ˆì¸¡_ë³µìš©ëŸ‰ = round(ì˜ˆì¸¡ê²°ê³¼[0][0], 2)
ì˜ˆì¸¡_ë³µìš©ì‹œê° = round(ì˜ˆì¸¡ê²°ê³¼[0][1], 2)

st.subheader("âœ… ì˜ˆì¸¡ ê²°ê³¼")
st.markdown(f"**ì¶”ì²œ ë³µìš©ëŸ‰:** {ì˜ˆì¸¡_ë³µìš©ëŸ‰} mg")
st.markdown(f"**ì¶”ì²œ ë³µìš© ì‹œê°:** {ì˜ˆì¸¡_ë³µìš©ì‹œê°} ì‹œ")

# ê²½ê³  ë©”ì‹œì§€
if ë‚˜ì´ >= 65 and ì²´ì¤‘ <= 50 and ì˜ˆì¸¡_ë³µìš©ëŸ‰ > 5:
    st.error("âš ï¸ ê³ ë ¹ ì €ì²´ì¤‘ ìƒíƒœì—ì„œ ë³µìš©ëŸ‰ì´ ë†’ìŠµë‹ˆë‹¤. ì˜ì‚¬ ìƒë‹´ ê¶Œì¥!")
elif ì˜ˆì¸¡_ë³µìš©ëŸ‰ > 7.5:
    st.warning("âš ï¸ ë³µìš©ëŸ‰ì´ ì¼ë°˜ ê¶Œì¥ëŸ‰ë³´ë‹¤ ë†’ìŠµë‹ˆë‹¤. ë³µìš© ì£¼ì˜!")
else:
    st.success("âœ… ë³µìš© ì•ˆì „ ë²”ìœ„ì…ë‹ˆë‹¤.")

# ì •ê·œë¶„í¬ ê¸°ë°˜ ìˆ˜ë©´ ì§€ì† ì‹œê°„ ì˜ˆì¸¡
í‰ê· ìˆ˜ë©´ = ì˜ˆì¸¡_ë³µìš©ëŸ‰
í‘œì¤€í¸ì°¨ = 1
P_4_to_6 = norm.cdf(6, í‰ê· ìˆ˜ë©´, í‘œì¤€í¸ì°¨) - norm.cdf(4, í‰ê· ìˆ˜ë©´, í‘œì¤€í¸ì°¨)
P_4_to_6 = round(P_4_to_6 * 100, 2)

st.subheader("ğŸ“Š ìˆ˜ë©´ ì§€ì† ì‹œê°„ ì˜ˆì¸¡")
st.markdown(f"**ì˜ˆì¸¡ëœ í‰ê·  ìˆ˜ë©´ ì‹œê°„:** {í‰ê· ìˆ˜ë©´} ì‹œê°„")
st.markdown(f"**ìˆ˜ë©´ì´ 4~6ì‹œê°„ ì§€ì†ë  í™•ë¥ :** {P_4_to_6}%")

# ì •ê·œë¶„í¬ ì‹œê°í™”
x = [i/10 for i in range(int((í‰ê· ìˆ˜ë©´-3)*10), int((í‰ê· ìˆ˜ë©´+3)*10))]
y = [norm.pdf(val, í‰ê· ìˆ˜ë©´, í‘œì¤€í¸ì°¨) for val in x]

fig1 = plt.figure(figsize=(8, 4))
plt.plot(x, y, label="ìˆ˜ë©´ ì§€ì† ì‹œê°„ ì •ê·œë¶„í¬")
plt.axvline(x=í‰ê· ìˆ˜ë©´, color='red', linestyle='--', label=f'ì˜ˆì¸¡ í‰ê· : {í‰ê· ìˆ˜ë©´}ì‹œê°„')
plt.fill_between(x, 0, y, where=[4<=val<=6 for val in x], color='skyblue', alpha=0.4, label="4~6ì‹œê°„ êµ¬ê°„")
plt.title("ì˜ˆìƒ ìˆ˜ë©´ ì§€ì† ì‹œê°„ ë¶„í¬")
plt.xlabel("ìˆ˜ë©´ ì§€ì† ì‹œê°„ (ì‹œê°„)")
plt.ylabel("í™•ë¥  ë°€ë„")
plt.legend()
plt.grid(True)
st.pyplot(fig1)

# ì‚¬ìš©ì ìœ„ì¹˜ ì‹œê°í™”
fig2 = plt.figure(figsize=(6, 5))
plt.scatter(df["ì²´ì¤‘"], df["ë‚˜ì´"], c=df["ì¶”ì²œ_ë³µìš©ëŸ‰"], cmap='coolwarm', label="í›ˆë ¨ ë°ì´í„°")
plt.scatter(ì²´ì¤‘, ë‚˜ì´, color='black', marker='X', s=120, label="ë‹¹ì‹ ")
plt.xlabel("ì²´ì¤‘ (kg)")
plt.ylabel("ë‚˜ì´")
plt.title("ì‚¬ìš©ìì˜ ë³µìš© ìœ„ì¹˜ ì‹œê°í™”")
plt.legend()
plt.colorbar(label="ë³µìš©ëŸ‰ (mg)")
plt.grid(True)
st.pyplot(fig2)
